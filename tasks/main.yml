---
# tasks file for vs-box-bootstrap

  - name: Sets correctly hostname
    lineinfile: dest=/etc/hosts line="127.0.0.1 {{ansible_hostname}}"
    sudo: yes

  - include: "{{root_dir}}/tasks_ufw.yml"

  - include: "{{root_dir}}/tasks_monit.yml"

  - include: "{{root_dir}}/use/__create_deploy_user.yml user={{deploy_user}} group={{deploy_user}} home=/home/{{deploy_user}}"
    when: deploy_user is defined

  - name: SSH | Authorize keys
    authorized_key: user={{deploy_user}} key="{{ lookup('file', item) }}"
    when: deploy_user_keys is defined
    with_items: "{{deploy_user_keys}}"
    sudo: yes

  - name: SSH | Enforce SSH keys security
    lineinfile: dest=/etc/ssh/sshd_config regexp="{{item.regexp}}" line="{{item.line}}"
    with_items: sshd_config_lines
    when: option_enforce_ssh_keys_login
    sudo: yes
    tags: ssh

  - name: SSH | Restart SSHD
    service: name=ssh state=restarted
    when: option_enforce_ssh_keys_login
    sudo: yes
    tags: ssh

  - name: Install base Ubuntu packages
    apt: pkg={{item}} state=present
    with_items:
      - unzip
      - mc
    sudo: yes
